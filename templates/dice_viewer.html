<!DOCTYPE html>
<html lang="fr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üé≤ Visionneur de D√©s - Thalric</title>

    <style>
        :root {
            --primary-gold: #d4af37;
            --secondary-gold: #f4e09a;
            --dark-bg: #1a1a1a;
            --medium-bg: #2d2d2d;
            --light-bg: #3a3a3a;
            --text-light: #ffffff;
            --text-muted: #b0b0b0;
            --success-green: #4caf50;
            --warning-orange: #ff9800;
            --danger-red: #f44336;
            --info-blue: #2196f3;
            --critical-color: #ff6b35;
            --fumble-color: #ff3838;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, var(--dark-bg) 0%, var(--medium-bg) 100%);
            color: var(--text-light);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            overflow-x: hidden;
        }

        .header {
            background: linear-gradient(135deg, var(--medium-bg) 0%, var(--light-bg) 100%);
            border-bottom: 3px solid var(--primary-gold);
            padding: 20px;
            text-align: center;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        }

        .header h1 {
            font-size: 2.5rem;
            color: var(--primary-gold);
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.7);
            margin-bottom: 5px;
        }

        .header .subtitle {
            color: var(--secondary-gold);
            font-size: 1.2rem;
        }

        .status-bar {
            background: var(--light-bg);
            padding: 10px 20px;
            border-bottom: 1px solid var(--primary-gold);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .connection-status {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .status-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: var(--success-green);
            animation: pulse 2s infinite;
        }

        .status-indicator.disconnected {
            background: var(--danger-red);
        }

        @keyframes pulse {

            0%,
            100% {
                opacity: 1;
            }

            50% {
                opacity: 0.5;
            }
        }

        .dice-container {
            flex: 1;
            padding: 20px;
            display: flex;
            flex-direction: column;
            gap: 15px;
            max-height: calc(100vh - 140px);
            overflow-y: auto;
        }

        .dice-result {
            background: linear-gradient(135deg, var(--medium-bg) 0%, var(--light-bg) 100%);
            border: 2px solid var(--primary-gold);
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.4);
            transform: translateY(20px);
            opacity: 0;
            animation: slideIn 0.6s ease-out forwards;
            position: relative;
            overflow: hidden;
        }

        .dice-result::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.1), transparent);
            animation: shimmer 2s ease-in-out;
        }

        @keyframes slideIn {
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        @keyframes shimmer {
            0% {
                left: -100%;
            }

            100% {
                left: 100%;
            }
        }

        .dice-result.critical-success {
            border-color: var(--critical-color);
            box-shadow: 0 0 30px rgba(255, 107, 53, 0.5);
        }

        .dice-result.critical-failure {
            border-color: var(--fumble-color);
            box-shadow: 0 0 30px rgba(255, 56, 56, 0.5);
        }

        .dice-result.damage-roll {
            border-color: var(--warning-orange);
            box-shadow: 0 0 20px rgba(255, 152, 0, 0.3);
        }

        .dice-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .dice-type {
            font-size: 1.2rem;
            color: var(--secondary-gold);
            font-weight: bold;
        }

        .dice-timestamp {
            font-size: 0.9rem;
            color: var(--text-muted);
            background: var(--dark-bg);
            padding: 5px 10px;
            border-radius: 20px;
        }

        .dice-main {
            text-align: center;
            margin: 20px 0;
        }

        .dice-formula {
            font-size: 1.1rem;
            color: var(--text-muted);
            margin-bottom: 10px;
        }

        .dice-total {
            font-size: 4rem;
            font-weight: bold;
            color: var(--primary-gold);
            text-shadow: 2px 2px 8px rgba(0, 0, 0, 0.5);
            margin: 10px 0;
            animation: numberPop 0.5s ease-out;
        }

        .critical-success .dice-total {
            color: var(--critical-color);
            animation: criticalGlow 1s ease-in-out infinite alternate;
        }

        .critical-failure .dice-total {
            color: var(--fumble-color);
            animation: fumbleShake 0.5s ease-in-out;
        }

        @keyframes numberPop {
            0% {
                transform: scale(0.5);
                opacity: 0;
            }

            50% {
                transform: scale(1.2);
            }

            100% {
                transform: scale(1);
                opacity: 1;
            }
        }

        @keyframes criticalGlow {
            0% {
                text-shadow: 0 0 20px var(--critical-color);
            }

            100% {
                text-shadow: 0 0 40px var(--critical-color), 0 0 60px var(--critical-color);
            }
        }

        @keyframes fumbleShake {

            0%,
            100% {
                transform: translateX(0);
            }

            25% {
                transform: translateX(-5px);
            }

            75% {
                transform: translateX(5px);
            }
        }

        .dice-details {
            font-size: 1rem;
            color: var(--text-muted);
            background: var(--dark-bg);
            padding: 10px 15px;
            border-radius: 8px;
            border: 1px solid var(--primary-gold);
        }

        .special-indicators {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 15px;
        }

        .indicator {
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: bold;
            display: none;
        }

        .indicator.critical {
            background: var(--critical-color);
            color: white;
            display: block;
            animation: pulse 1.5s infinite;
        }

        .indicator.fumble {
            background: var(--fumble-color);
            color: white;
            display: block;
        }

        .indicator.damage {
            background: var(--warning-orange);
            color: white;
            display: block;
        }

        .no-rolls {
            text-align: center;
            color: var(--text-muted);
            font-size: 1.2rem;
            margin-top: 50px;
            animation: breathe 3s ease-in-out infinite;
        }

        @keyframes breathe {

            0%,
            100% {
                opacity: 0.7;
            }

            50% {
                opacity: 1;
            }
        }

        .footer {
            background: var(--medium-bg);
            padding: 15px;
            text-align: center;
            border-top: 1px solid var(--primary-gold);
            color: var(--text-muted);
            font-size: 0.9rem;
        }

        /* Responsive pour tablette */
        @media (max-width: 768px) {
            .header {
                padding: 15px;
            }

            .header h1 {
                font-size: 2rem;
            }

            .header .subtitle {
                font-size: 1rem;
            }

            .status-bar {
                padding: 10px 15px;
                flex-wrap: wrap;
                gap: 10px;
            }

            .dice-container {
                padding: 15px;
                gap: 12px;
            }

            .dice-result {
                padding: 20px;
            }

            .dice-total {
                font-size: 3rem;
            }

            .dice-type {
                font-size: 1.1rem;
            }

            .special-indicators {
                flex-wrap: wrap;
                gap: 10px;
            }
        }

        /* Responsive pour mobile */
        @media (max-width: 480px) {
            .header {
                padding: 12px;
            }

            .header h1 {
                font-size: 1.5rem;
            }

            .header .subtitle {
                font-size: 0.85rem;
            }

            .status-bar {
                padding: 8px 12px;
                flex-direction: column;
                align-items: flex-start;
                gap: 8px;
            }

            .status-bar > div:last-child {
                width: 100%;
                display: flex;
                justify-content: space-between;
                font-size: 0.85rem;
            }

            #last-update {
                font-size: 0.75rem;
            }

            #roll-counter {
                padding: 4px 10px;
                font-size: 0.85rem;
            }

            .dice-container {
                padding: 10px;
                gap: 10px;
                max-height: calc(100vh - 180px);
            }

            .dice-result {
                padding: 15px;
                border-radius: 12px;
            }

            .dice-header {
                flex-direction: column;
                gap: 8px;
                align-items: flex-start;
            }

            .dice-type {
                font-size: 1rem;
                width: 100%;
            }

            .dice-timestamp {
                font-size: 0.75rem;
                padding: 4px 8px;
            }

            .dice-total {
                font-size: 2.5rem;
                margin: 15px 0;
            }

            .dice-formula {
                font-size: 0.95rem;
                margin-bottom: 8px;
            }

            .dice-details {
                font-size: 0.85rem;
                padding: 8px 12px;
            }

            .special-indicators {
                flex-direction: column;
                gap: 8px;
            }

            .indicator {
                padding: 6px 12px;
                font-size: 0.8rem;
                width: 100%;
                text-align: center;
            }

            .no-rolls {
                font-size: 1rem;
                padding: 0 20px;
            }

            .footer {
                padding: 10px;
                font-size: 0.75rem;
            }
        }

        /* Mode paysage tablette/mobile */
        @media (orientation: landscape) and (max-height: 600px) {
            .header {
                padding: 10px;
            }

            .header h1 {
                font-size: 1.5rem;
            }

            .header .subtitle {
                font-size: 0.9rem;
            }

            .status-bar {
                padding: 6px 15px;
            }

            .dice-container {
                max-height: calc(100vh - 120px);
            }

            .dice-total {
                font-size: 2.5rem;
            }

            .dice-result {
                padding: 12px;
            }

            .dice-main {
                margin: 10px 0;
            }

            .footer {
                padding: 8px;
                font-size: 0.75rem;
            }
        }

        /* Mode tr√®s petit √©cran (< 360px) */
        @media (max-width: 360px) {
            .header h1 {
                font-size: 1.3rem;
            }

            .header .subtitle {
                font-size: 0.75rem;
            }

            .dice-total {
                font-size: 2rem;
            }

            .dice-type {
                font-size: 0.9rem;
            }

            .dice-result {
                padding: 12px;
            }
        }
    </style>
</head>

<body>
    <!-- En-t√™te -->
    <header class="header">
        <h1>üé≤ Visionneur de D√©s</h1>
        <div class="subtitle">Thalric C≈ìur d'Argent - Dashboard</div>
    </header>

    <!-- Barre de statut -->
    <div class="status-bar">
        <div class="connection-status">
            <div class="status-indicator" id="status-indicator"></div>
            <span id="connection-text">Connexion...</span>
        </div>
        <div style="display: flex; gap: 10px; align-items: center; flex-wrap: wrap;">
            <div id="roll-counter" style="background: var(--dark-bg); padding: 5px 12px; border-radius: 15px; font-weight: bold;">
                <span style="color: var(--primary-gold);">üé≤ </span><span id="roll-count">0</span>
            </div>
            <div id="last-update" style="white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">En attente...</div>
        </div>
    </div>

    <!-- Container des r√©sultats de d√©s -->
    <div class="dice-container" id="dice-container">
        <div class="no-rolls" id="no-rolls">
            üéØ En attente des lancers de d√©s...<br>
            <small>Les r√©sultats s'afficheront ici en temps r√©el</small>
        </div>
    </div>

    <!-- Pied de page -->
    <footer class="footer">
        Visionneur synchronis√© avec le Dashboard Thalric ‚Ä¢ WebSocket en temps r√©el
    </footer>

    <!-- Socket.IO JavaScript -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.7.2/socket.io.js"></script>

    <script>
        // Initialisation WebSocket
        const socket = io();
        let rollCount = 0;

        // √âl√©ments DOM
        const statusIndicator = document.getElementById('status-indicator');
        const connectionText = document.getElementById('connection-text');
        const lastUpdate = document.getElementById('last-update');
        const diceContainer = document.getElementById('dice-container');
        const noRolls = document.getElementById('no-rolls');

        // Connexion WebSocket
        socket.on('connect', function () {
            console.log('‚úÖ Connect√© au serveur WebSocket');
            statusIndicator.classList.remove('disconnected');
            connectionText.textContent = 'Connect√©';
            lastUpdate.textContent = new Date().toLocaleTimeString('fr-FR', {hour: '2-digit', minute: '2-digit'});
        });

        socket.on('disconnect', function () {
            console.log('‚ùå D√©connect√© du serveur WebSocket');
            statusIndicator.classList.add('disconnected');
            connectionText.textContent = 'D√©connect√©';
            lastUpdate.textContent = 'Reconnexion...';
        });

        socket.on('status', function (data) {
            console.log('üì° Statut:', data.msg);
        });

        // R√©ception d'un nouveau jet de d√©
        socket.on('new_dice_roll', function (data) {
            console.log('üé≤ Nouveau jet re√ßu:', data);
            displayDiceResult(data);
            rollCount++;

            // Masquer le message "En attente"
            if (noRolls.style.display !== 'none') {
                noRolls.style.display = 'none';
            }

            // Mettre √† jour le compteur
            document.getElementById('roll-count').textContent = rollCount;

            // Mettre √† jour le statut (format court pour mobile)
            const shortTime = new Date().toLocaleTimeString('fr-FR', {hour: '2-digit', minute: '2-digit', second: '2-digit'});
            lastUpdate.textContent = shortTime;

            // Texte adaptatif selon largeur √©cran
            if (window.innerWidth < 480) {
                connectionText.textContent = `‚úì ${rollCount} jets`;
            } else {
                connectionText.textContent = `Connect√© - ${rollCount} jet(s)`;
            }
        });

        function displayDiceResult(data) {
            // Cr√©er l'√©l√©ment du r√©sultat
            const resultElement = document.createElement('div');
            resultElement.className = `dice-result ${data.animation_class || 'normal-roll'}`;

            // Format timestamp court pour mobile
            const timestamp = window.innerWidth < 480
                ? new Date().toLocaleTimeString('fr-FR', {hour: '2-digit', minute: '2-digit'})
                : data.timestamp;

            // Contenu HTML du r√©sultat
            resultElement.innerHTML = `
                <div class="dice-header">
                    <div class="dice-type">${data.roll_type}</div>
                    <div class="dice-timestamp">${timestamp}</div>
                </div>
                
                <div class="dice-main">
                    <div class="dice-formula">${data.formula}</div>
                    <div class="dice-total">${data.result}</div>
                    <div class="dice-details">${data.details}</div>
                </div>
                
                <div class="special-indicators">
                    <div class="indicator critical ${data.is_critical ? '' : 'hidden'}" style="display: ${data.is_critical ? 'block' : 'none'}">
                        ‚ú® CRITIQUE! ‚ú®
                    </div>
                    <div class="indicator fumble ${data.is_fumble ? '' : 'hidden'}" style="display: ${data.is_fumble ? 'block' : 'none'}">
                        üíÄ √âCHEC CRITIQUE
                    </div>
                    <div class="indicator damage ${data.damage_type ? '' : 'hidden'}" style="display: ${data.damage_type ? 'block' : 'none'}">
                        ‚öîÔ∏è D√âG√ÇTS
                    </div>
                </div>
            `;

            // Ins√©rer en haut de la liste
            diceContainer.insertBefore(resultElement, diceContainer.firstChild);

            // Limiter √† 20 r√©sultats maximum (comme l'historique principal)
            const results = diceContainer.querySelectorAll('.dice-result');
            if (results.length > 20) {
                // Supprimer tous les r√©sultats au-del√† des 20 premiers
                for (let i = 20; i < results.length; i++) {
                    results[i].remove();
                }
            }

            // Scroll automatique vers le nouveau r√©sultat
            resultElement.scrollIntoView({ behavior: 'smooth', block: 'start' });

            // Effet sonore (optionnel)
            playDiceSound(data);
        }

        function playDiceSound(data) {
            // Vous pouvez ajouter des effets sonores ici
            if (data.is_critical) {
                console.log('üîä Son de critique!');
            } else if (data.is_fumble) {
                console.log('üîä Son d\'√©chec!');
            } else {
                console.log('üîä Son de d√© normal');
            }
        }

        // Test de connexion p√©riodique
        setInterval(function () {
            socket.emit('ping');
        }, 30000); // Ping toutes les 30 secondes

        // Gestion des erreurs de connexion
        socket.on('connect_error', function (error) {
            console.error('‚ùå Erreur de connexion:', error);
            statusIndicator.classList.add('disconnected');
            connectionText.textContent = 'Erreur de connexion';
        });

        // Message de bienvenue
        document.addEventListener('DOMContentLoaded', function () {
            console.log('üé≤ Visionneur de D√©s Thalric initialis√©');
            console.log('üì± Optimis√© pour tablette et mobile');
        });
    </script>
</body>

</html>