<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}Thalric Cœur d'Argent{% endblock %}</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body>
    <div class="container">
        <!-- Header avec informations du personnage -->
        <header class="character-header">
            <div class="character-info">
                <h1>{{ character.character_info.name }}</h1>
                <p>{{ character.character_info.race }} {{ character.character_info.class }} - Niveau {{ character.character_info.level }}</p>
                <p class="subclass">{{ character.character_info.subclass }}</p>
            </div>
            <div class="vital-stats">
                <div class="hp-display">
                    <span class="hp-current" id="hp-current">{{ character.stats.hp_current }}</span>
                    <span class="hp-separator">/</span>
                    <span class="hp-max">{{ character.stats.hp_max }}</span>
                    <label>HP</label>
                </div>
                <div class="ac-display">
                    <span class="ac-value">{{ character.stats.ac }}</span>
                    <label>CA</label>
                </div>
            </div>
        </header>

        <!-- Navigation mise à jour avec la page Dés -->
        <nav class="main-nav">
            <a href="{{ url_for('state') }}" class="nav-item {% if request.endpoint == 'state' %}active{% endif %}">
                <span class="nav-icon">📊</span>
                <span class="nav-text">Stats</span>
            </a>
            <a href="{{ url_for('combat') }}" class="nav-item {% if request.endpoint == 'combat' %}active{% endif %}">
                <span class="nav-icon">⚔️</span>
                <span class="nav-text">Combat</span>
            </a>
            <a href="{{ url_for('spells') }}" class="nav-item {% if request.endpoint == 'spells' %}active{% endif %}">
                <span class="nav-icon">✨</span>
                <span class="nav-text">Sorts</span>
            </a>
            <a href="{{ url_for('conditions') }}" class="nav-item {% if request.endpoint == 'conditions' %}active{% endif %}" style="position: relative;">
                <span class="nav-icon">🩹</span>
                <span class="nav-text">Conditions</span>
                <span class="conditions-badge" id="conditions-badge" style="position: absolute; top: -5px; right: -5px; background: var(--danger-red); color: white; border-radius: 50%; width: 20px; height: 20px; display: none; align-items: center; justify-content: center; font-size: 0.7rem; font-weight: bold;"></span>
            </a>
            <a href="{{ url_for('dice_roller') }}" class="nav-item {% if request.endpoint == 'dice_roller' %}active{% endif %}">
                <span class="nav-icon">🎲</span>
                <span class="nav-text">Dés</span>
            </a>
            <a href="{{ url_for('inventory') }}" class="nav-item {% if request.endpoint == 'inventory' %}active{% endif %}">
                <span class="nav-icon">🎒</span>
                <span class="nav-text">Inventaire</span>
            </a>
            <a href="{{ url_for('gestion') }}" class="nav-item {% if request.endpoint == 'gestion' %}active{% endif %}">
                <span class="nav-icon">⚙️</span>
                <span class="nav-text">Gestion</span>
            </a>
        </nav>

        <!-- Contenu principal -->
        <main class="main-content">
            {% block content %}{% endblock %}
        </main>

        <!-- Zone de résultats des dés -->
        <div class="dice-results" id="dice-results" style="display: none;">
            <div class="result-content">
                <span class="close-result" onclick="closeDiceResult()">×</span>
                <div class="result-text" id="result-text"></div>
            </div>
        </div>
    </div>

    <!-- Toggle de thème -->
    <div class="theme-toggle" onclick="toggleTheme()" title="Changer le thème (T)">
        <span class="theme-toggle-icon">🌙</span>
    </div>

    <!-- Historique des dés -->
    <div class="history-toggle" onclick="toggleHistory()" title="Historique des dés (H)">
        <span class="history-toggle-icon">📜</span>
        <span class="history-badge" style="display: none;">0</span>
    </div>

    <div class="dice-history">
        <div class="history-header">
            <span class="history-title">Historique des Jets</span>
            <div style="display: flex; gap: 10px; align-items: center;">
                <button class="btn btn-small btn-danger" onclick="clearHistory()" title="Effacer l'historique">🗑️</button>
                <span class="history-close" onclick="toggleHistory()">×</span>
            </div>
        </div>
        <div class="history-content">
            <!-- Les items d'historique seront ajoutés dynamiquement -->
        </div>
    </div>

    <!-- Aide des raccourcis clavier -->
    <div class="shortcuts-help">
        <div class="shortcuts-title">Raccourcis Clavier</div>
        <div class="shortcut-item">
            <span class="shortcut-desc">Historique</span>
            <span class="shortcut-key">H</span>
        </div>
        <div class="shortcut-item">
            <span class="shortcut-desc">Changer thème</span>
            <span class="shortcut-key">T</span>
        </div>
        <div class="shortcut-item">
            <span class="shortcut-desc">Sons on/off</span>
            <span class="shortcut-key">S</span>
        </div>
        <div class="shortcut-item">
            <span class="shortcut-desc">Cette aide</span>
            <span class="shortcut-key">?</span>
        </div>
        <div class="shortcut-item">
            <span class="shortcut-desc">Fermer/Échap</span>
            <span class="shortcut-key">ESC</span>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://cdn.socket.io/4.5.4/socket.io.min.js"></script>
    <script src="{{ url_for('static', filename='js/main.js') }}"></script>
    {% block scripts %}{% endblock %}

    <!-- Script pour le badge de conditions -->
    <script>
    async function updateConditionsBadge() {
        try {
            const res = await fetch('/api/conditions/list');
            if (!res.ok) return;
            const data = await res.json();

            const badge = document.getElementById('conditions-badge');
            if (data.count > 0) {
                badge.textContent = data.count;
                badge.style.display = 'flex';
            } else {
                badge.style.display = 'none';
            }
        } catch (err) {
            // Silencieux - ne pas afficher d'erreur dans le badge
        }
    }

    // Mettre à jour au chargement
    document.addEventListener('DOMContentLoaded', () => {
        updateConditionsBadge();
        // Actualiser toutes les 10 secondes
        setInterval(updateConditionsBadge, 10000);
    });
    </script>
</body>
</html>